### フェーズ2: 設計 - デプロイメント戦略 - 2025-07-28T12:10:00Z
**目的**: 既存の高品質な実装をAzureにデプロイするための戦略を策定
**コンテキスト**: 
- プロジェクトは95%完成しており、コードとインフラストラクチャは実装済み
- Azure環境が初期化されていない
- 仕様変更を反映済み（Container Appsサブネット: 10.0.1.0/24、ワークロードプロファイル: Consumption）
**決定**: 信頼度スコア95%に基づき、即座にデプロイ可能な状態に持っていく
**実行**: デプロイメント計画の策定

## 実行戦略

### 信頼度評価: 95%
- **根拠**:
  - すべての主要コンポーネントが実装済み
  - テストが充実している
  - ドキュメントが完備している
  - 設計が明確で実装と一致している

### アプローチ: 高信頼度実行
1. 軽微な設定調整
2. Azure環境の初期化とデプロイ
3. 動作検証
4. ドキュメントの最終更新

## 仕様変更の反映

### 完了した変更
1. **Container Appsサブネット範囲**:
   - 変更前: 10.0.0.0/23
   - 変更後: 10.0.1.0/24
   - ファイル: infra/modules/network.bicep

2. **Container Apps環境のワークロードプロファイル**:
   - Consumptionタイプを追加
   - ファイル: infra/modules/container-apps-environment.bicep

## デプロイメント計画

### 1. 設定調整（10分）
- **Redisポート設定の確認**:
  - Azure Managed Redisは標準で10000番ポートを使用
  - 現在の設定を確認し、必要に応じて調整

### 2. Azure環境セットアップ（30分）
- **azd初期化**:
  ```bash
  azd init
  azd auth login
  ```
- **環境変数の設定**:
  - 必要な環境変数の確認
  - azdパラメータの設定

### 3. インフラストラクチャとアプリケーションのデプロイ（45分）
- **ワンコマンドデプロイ**:
  ```bash
  azd up
  ```
- **デプロイ内容**:
  - すべてのAzureリソース（更新されたネットワーク設定含む）
  - Dockerイメージのビルドとプッシュ
  - Container Appへのデプロイ

### 4. 動作検証（30分）
- **基本動作確認**:
  - ヘルスチェックエンドポイント
  - Redis接続
  - Application Insights統合
- **カオス機能テスト**:
  - 負荷注入API
  - ハングアップAPI
  - ネットワーク障害スクリプト

### 5. 統合テスト実行（20分）
- **E2Eテスト**:
  - すべての障害シナリオ
  - 復旧動作
  - 監視データの確認

## エラー処理計画

### 想定されるエラーと対処

1. **Redis認証エラー**:
   - マネージドアイデンティティのアクセスポリシー確認
   - Bicepテンプレートでの自動設定を検証

2. **NSG設定エラー**:
   - Container Appsサブネットの設定確認
   - 送信ルールの検証

3. **デプロイメント失敗**:
   - リソースグループの完全削除と再作成
   - `azd down --force --purge`の使用

## 成功基準

- [ ] azd upが正常に完了
- [ ] すべてのエンドポイントが応答
- [ ] Redis接続が確立
- [ ] カオス注入機能が動作
- [ ] Application Insightsでデータ確認
- [ ] 統合テストがパス

**出力**: 詳細なデプロイメント計画と成功基準（仕様変更反映済み）
**検証**: 高信頼度に基づく効率的な実行計画
**次**: フェーズ3: 実装（設定調整とデプロイ）